"use strict";window.Pmock={};Pmock.register=function(t,e){window[t]=e();return e};Pmock.when=function(){return{register:function(t,e){Pmock.register(t,e)}}};if(typeof String.prototype.capitalize!=="function"){String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.toLowerCase().slice(1)}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(t,e){var i;if(this===null){throw new TypeError('"this" is null or not defined')}var r=new Object(this);var s=r.length;if(s===0){return-1}var a=+e||0;if(Math.abs(a)===Infinity){a=0}if(a>=s){return-1}i=Math.max(a>=0?a:s-Math.abs(a),0);while(i<s){if(i in r&&r[i]===t){return i}i++}return-1}}Pmock.register("Cookie",function(){var e=e||{};e.write=function(t,e,i){if(!i){return false}if(typeof i==="number"){var r=new Date;r.setTime(r.getTime()+i*24*60*60*1e3);i=r}else if(i instanceof Date===false){return false}var s=t+"="+encodeURIComponent(e)+"; expires="+i+";path=/";document.cookie=s;return s};e.read=function(t){var e=document.cookie.split(";"),i=null;for(var r=0;r<e.length;r++){i=e[r].trim();if(i.indexOf(t)===0){i=i.substring(t.length+1,i.length);return decodeURIComponent(i)}}return null};e.destroy=function(t){e.write(t,"",new Date("Thu, 01 Jan 1970 00:00:01 UTC"));return document.cookie};return e});if(typeof String.prototype.regexpEscape!=="function"){String.prototype.regexpEscape=function(){return this.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")}}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}Pmock.register("URI",function(){var t=function(){r.prototype.uri="";r.prototype.authority="";r.prototype.query="";r.prototype.fragment="";r.prototype.params=[];function r(t){this.uri="";if(t){this.set(t)}}r.prototype.set=function(t){if(t instanceof r){this.uri=t.uri}else{this.uri=t;this.fragment=this.getFragment();this.params=this.getParamsAsArray();this.authority=this.getAuthority();var e=null;this.uri=this.authority;for(var i=0;i<this.params.length;i++){e=this.params[i].split("=");this.addParam(decodeURIComponent(e[0]),decodeURIComponent(e[1]))}this.build()}return this};r.prototype.toString=function(){return this.uri};r.prototype.addParam=function(t,e,i){if(t){if(typeof e==="undefined"){e=""}var r=this.getParamsAsArray(),s=encodeURIComponent(t)+"="+encodeURIComponent(e);var a=this.getQueryParam(t);if(a&&i){this.removeParam(t);r=this.getParamsAsArray();r.push(s)}else if(!a){r.push(s)}this.query=this.buildQuery(r);this.build()}return this};r.prototype.removeParam=function(t){if(t){var e=this.getParamsAsArray();if(e&&e.length>0){for(var i=e.length-1;i>=0;i--){var r=e[i].split("=");if(decodeURIComponent(r[0]).match(t)){e.splice(i,1)}}}this.query=this.buildQuery(e);this.build()}return this};r.prototype.setParams=function(t,e){if(t&&Object.prototype.toString.call(t)==="[object Array]"){for(var i=0;i<=t.length-1;i++){if(typeof t[i]==="string"){var r=t[i].split("=");if(r.length===2){this.addParam(r[0],r[1],e)}}}}return this};r.prototype.setFragment=function(t){this.fragment=t;this.build()};r.prototype.getAuthority=function(){var t=this.uri.split("?")[0].trim();t=this.removeFragment(t);return t};r.prototype.getOrigin=function(){return this.uri.match(/([a-zA-Z]*:\/\/[a-zA-Z0-9.\-:]*)\/{1}/gi)[0]};r.prototype.getQuery=function(){var t=this.uri.split("?");if(t.length>1){return"?"+this.removeFragment(t[1])}return null};r.prototype.getFragment=function(){var t=this.uri.split("#");if(t.length>1){return"#"+t[1]}return""};r.prototype.removeFragment=function(t){return t.split("#")[0]};r.prototype.getQueryParamValue=function(t){if(t){var e=this.getQueryParam(t);if(e){return e[1]}}return null};r.prototype.getQueryParam=function(t){if(t){var e=this.getParamsAsArray();if(t instanceof RegExp===false){t=new RegExp("^"+t.regexpEscape()+"$")}if(e&&e.length>0){for(var i=0;i<e.length;i++){var r=e[i].split("=");if(decodeURIComponent(r[0]).match(t)){return[decodeURIComponent(r[0]),decodeURIComponent(r[1])]}}}}return null};r.prototype.getParamsAsArray=function(){var t=this.getQuery();if(t){t=t.substring(1);return t.split("&")}return[]};r.prototype.build=function(){this.uri=this.authority+this.query+this.fragment};r.prototype.buildQuery=function(t){var e="";if(typeof t==="object"&&t.length>0){e="?"+t.join("&")}return e};return r}();return t});Pmock.when("URI","Cookie").register("LeadCode",function(l,r){if(!l){l=window.URI}if(!r){r=window.Cookie}var t=function(){function t(t){this.version="3.0";this.settings={prefix:"",marketingChannel:"",locale:"",product:"",defaultCode:"Direct",appendix:"",overrideStaticLeadCode:true,ignoreCustomLeadCode:false,overrideExistingCookie:true,cookieExpireTime:15,srcOrder:["url","referrer","cookie"],hookBefore:function(){},hookAfter:function(){},hookUpdateCode:this.handleUrpCode,hookPrepareUrl:this.handleUrpUrls,leadCodeAttr:"ld",leadCodeCookieAttr:"ld",ignoreInternalUrls:true,restrictElemSearchTo:"body",autoRun:true,mappings:{},separator:"",ignoreValidation:false,debug:false,writeCookie:true,defaultNotRequired:false};for(var e in t){if(typeof t[e]!=="undefined"){this.settings[e]=t[e]}}this.dataTrack=this.settings.leadCodeAttr+"-track";this.dataCustom=this.settings.leadCodeAttr+"-custom";this.dataStatic=this.settings.leadCodeAttr+"-static";this.dataPrepend=this.settings.leadCodeAttr+"-prepend";this.dataAppend=this.settings.leadCodeAttr+"-append";this.trackElements=["a[href]:not([data-"+this.dataTrack+"=false])","area:not([data-"+this.dataTrack+"=false])","iframe[data-"+this.dataTrack+"=true]","option[data-"+this.dataTrack+"=true]"];this.trackElementsLegacy="a, area";this.overrideSettingsDom="[data-"+this.settings.leadCodeAttr+"-overrides=true]";this.leadCode=null;this.findRegex=/#|\?|\&/;this.url=new l(location.href);this.referrerPrefix="EL";this.naturalSearchPrefix="NS";this.naturalSearchUrlList={google:"www\\.google\\.",bing:"www\\.bing\\.",yahoo:"\\.search\\.yahoo\\.",baidu:"www\\.baidu\\."};this.nomenclature={allowedSeparators:["_","-",".",""],defaultSeparator:""};if(typeof window.localStorage==="object"){this.localStorageExists=true}this.paramRegex=new RegExp("^(.+(/|%2f))?"+this.settings.leadCodeAttr+"$","gi");this.readSettingsFromDom();this.validateSettings();this.validateSeparator();if(this.settings.debug){this.log("Script Version: "+this.version);if(typeof jQuery==="function"){this.log("jQuery is available.")}else{this.log("jQuery is NOT available. This lead code script might not find all targeted items. Please try to make jQuery available.","warn")}this.log("Settings:");this.log(this.settings);if(!this.settings.marketingChannel){this.log('marketingChannel is NOT set. It is recommended to set a prefix at any time to identify your own lead codes (Example: "AS")',"warn")}this.log("Mappings: The following code mappings are registered.");this.log(this.settings.mappings)}if(this.settings.autoRun){this.init()}}var e=t.prototype;e.init=function(){this.settings.hookBefore();this.getCode();if(this.leadCode){this.setCode()}this.settings.hookAfter()};e.validateSettings=function(){if(!this.settings.ignoreValidation){this.settings.marketingChannel=this.settings.marketingChannel.toUpperCase();this.settings.defaultCode=this.settings.defaultCode.capitalize();this.settings.locale=this.settings.locale.toUpperCase();this.settings.leadCodeAttr=this.settings.leadCodeAttr.toLowerCase()}};e.validateSeparator=function(){if(this.nomenclature.allowedSeparators.indexOf(this.settings.separator)===-1){this.log('Unknown Lead Code separator "'+this.settings.separator+'". Switching to default separator "'+this.nomenclature.defaultSeparator+'"',"warn");this.settings.separator=this.nomenclature.defaultSeparator}};e.getCode=function(){for(var t=0;t<this.settings.srcOrder.length;t++){switch(this.settings.srcOrder[t].toLowerCase()){case"url":var e=this.extractLeadCodeFromUrl(this.url);if(e){this.leadCode=e}break;case"cookie":this.leadCode=this.getFromCookie();break;case"referrer":var i=this.getDocumentReferrer();if(this.isUrlExternal(i)){this.leadCode=this.getFromReferer()}else{this.log("Ignoring referrer step due to internal referral.")}break}if(this.leadCode){this.log("LeadCode found in "+this.settings.srcOrder[t]+' -> "'+this.settings.leadCodeAttr+'", "'+this.settings.leadCodeCookieAttr+'" -> '+this.leadCode);break}}if(!this.leadCode&&!this.settings.defaultNotRequired){this.leadCode=this.getDefault()}return this.leadCode};e.setCode=function(){var t,e,i=false;e=this.getElementsToBeTracked();for(var r=0;r<e.length;r++){var s=new l,a="";var n=this.getAttrNameFromNode(e[r]);s.set(e[r].getAttribute(n));i=this.unwrapRedirect(new l(s.toString()));if(i){s.set(i["location"])}var o=this.settings.hookUpdateCode(s);if(!this.settings.overrideStaticLeadCode){a=this.extractLeadCodeFromUrl(s);if(a){a=a}}s.set(this.removeStaticCodeFromUrl(s));a=this.handleCustomCodes(e[r],a);if(!a){a=this.leadCode}a=this.handleVariations(e[r],a);s.set(this.settings.hookPrepareUrl(s));s.addParam(o+this.settings.leadCodeAttr,a);if(i!==false){s.set(this.wrapRedirect(i,s))}e[r].setAttribute(n,s.toString());this.log("Set LeadCode on "+e[r].outerHTML+"\n   -> "+s.toString())}if(this.settings.writeCookie){this.writeCookie(this.leadCode)}else{this.log("Cookie was not set due to the setting.writeCookie being false.","warn")}};e.buildCode=function(t,e){var i;switch(e){case"natural":i=[this.naturalSearchPrefix,t.capitalize()];break;case"referrer":var r=t.split("/")[2];if(this.settings.separator===""){r="-"+r}i=[this.referrerPrefix,this.settings.locale,this.settings.product,r];break;case"standard":i=[this.settings.marketingChannel,this.settings.locale,this.settings.product,t];break;default:i=[this.settings.marketingChannel,this.settings.locale,this.settings.product,this.settings.defaultCode];break}return i.join(this.settings.separator)};e.readSettingsFromDom=function(){var t="data-"+this.settings.leadCodeAttr+"-",e=this.getDomElements(this.overrideSettingsDom,true);if(e.length){var i=e[0].attributes;for(var r=i.length-1;r>=0;r--){if(i[r].name.indexOf(t+"overrides")===-1){var s=i[r].name.replace(t+"setting-","");s=s.replace(/-([a-z])/g,function(t,e){return e.toUpperCase()});var a=this.handleTypeCast(i[r].value);this.settings[s]=a;this.log("Overridden DOM Setting: "+s+" = "+this.settings[s])}}}};e.removeStaticCodeFromUrl=function(t){t.removeParam(this.paramRegex);return t};e.getElementsToBeTracked=function(){var t=this.trackElements;if(this.settings.restrictElemSearchTo&&this.settings.restrictElemSearchTo!=="body"){var e=this.settings.restrictElemSearchTo.split(",");var i=[];for(var r=e.length-1;r>=0;r--){var s=e[r];for(var a=t.length-1;a>=0;a--){i.push([s.trim(),t[a]].join(" "))}}t=i}var n=this.getDomElements(t.join(", "));n=Array.prototype.slice.call(n);if(this.settings.ignoreInternalUrls){var o=null;for(var r=n.length-1;r>=0;r--){var h=this.getAttrNameFromNode(n[r]);o=new l(n[r].getAttribute(h));if(!(o.toString()&&this.isUrlExternal(o))&&!this.isTrackable(n[r])){this.log("Remove URL ("+o.toString()+") from tracking list. It is an internal link.");n.splice(r,1)}}}return n};e.getAttrNameFromNode=function(t){var e="href";switch(t.nodeName){case"OPTION":e="value";break;case"IFRAME":e="src";break}return e};e.isTrackable=function(t){return t.getAttribute("data-"+this.dataTrack)?true:false};e.getDomElements=function(t,e){var i=[];if(typeof jQuery==="function"){i=jQuery(t)}else{if(typeof document.querySelectorAll==="function"){try{i=document.querySelectorAll(t)}catch(t){this.log("ERROR: "+t.stack)}}else{if(!e){var r=this.trackElementsLegacy.split(",");i=[];for(var s=0;s<r.length;s++){i=i.concat(Array.prototype.slice.call(document.getElementsByTagName(r[s].trim())))}}}}return i};e.getDocumentReferrer=function(){return new l(document.referrer)};e.getLocationHost=function(){return new l(location.host)};e.isUrlExternal=function(t){var e=/^(http[s]?:)?\/\//;var i=t.toString().match(e)&&this.getLocationHost().toString()!==t.toString().replace(e,"").split("/")[0];if(!i){if(t.getAuthority().match(/redirect/)){i=t}}return i};e.unwrapRedirect=function(t){var e=t.getQueryParamValue("location"),i=false;if(e){i={};i["location"]=decodeURIComponent(e);t.removeParam("location");i["url"]=t}return i};e.wrapRedirect=function(t,e){t["url"].addParam("location",e);return t["url"]};e.extractLeadCodeFromUrl=function(t){return t.getQueryParamValue(this.paramRegex)};e.getFromCookie=function(){return r.read(this.settings.leadCodeCookieAttr)};e.writeCookie=function(t){var e=this.getFromCookie();if(!e||e&&this.settings.overrideExistingCookie){var i=r.write(this.settings.leadCodeCookieAttr,t,this.settings.cookieExpireTime);this.log("Cookie set: "+i)}};e.destroyCookie=function(){r.destroy(this.settings.leadCodeCookieAttr);this.log("Cookie destroyed")};e.handleCustomCodes=function(t,e){if(!this.settings.ignoreCustomLeadCode){var i=t.getAttribute("data-"+this.dataCustom);var r=t.getAttribute("data-"+this.dataStatic);if(r){i=r}if(i){return this.buildCode(i,"standard")}else{return e}}};e.getFromReferer=function(){var t=null,e=null,i=null,r=this.getDocumentReferrer().toString();if(r){for(var s in this.naturalSearchUrlList){if(typeof this.naturalSearchUrlList[s]!=="undefined"){e=new RegExp(this.naturalSearchUrlList[s],"i");if(r.match(e,"i")){i=s;break}}}if(i){t=this.buildCode(i,"natural")}else{t=this.buildCode(r,"referrer")}t=this.handleMappings(t)}return t};e.handleMappings=function(t){var e;for(var i in this.settings.mappings){if(t.indexOf(i.toLowerCase())>-1){e=this.settings.mappings[i];break}}if(e){t=this.buildCode(this.settings.mappings[i],"standard")}return t};e.getDefault=function(){var t=this.buildCode();t=this.handlePrefix(t,this.settings.prefix);t=this.handleAppendix(t,this.settings.appendix);this.log("Default LeadCode -> "+t);return t};e.handleVariations=function(t,e){var i=t.getAttribute("data-"+this.dataPrepend);if(!i){i=""}var r=t.getAttribute("data-"+this.dataAppend);if(!r){r=""}e=this.handlePrefix(e,i);e=this.handleAppendix(e,r);e=this.handlePrefix(e,this.settings.prefix);e=this.handleAppendix(e,this.settings.appendix);return e};e.handleAppendix=function(t,e){if(e){e=this.trimString(e);if(this.settings.separator===""){e="_"+e}else{e=this.settings.separator+e}if(t.indexOf(e)===-1){t+=e}}return t};e.handlePrefix=function(t,e){if(e){e=this.trimString(e);if(this.settings.separator===""){e+="_"}else{e+=this.settings.separator}if(t.indexOf(e)===-1){t=e+t}}return t};e.trimString=function(t){t=t.replace(/^[^a-zA-Z0-9]*/g,"");t=t.replace(/[^a-zA-Z0-9]*$/g,"");return t};e.handleUrpCode=function(t){if(t.toString().indexOf("passthrough")>-1){return"passthrough/"}return""};e.handleUrpUrls=function(t){return t.removeParam("passthrough(/|%2F)$")};e.handleTypeCast=function(t){if((parseInt(t,10)||0)===null){return parseInt(t,10)}if(t==="false"||t==="true"){return t==="true"?true:false}return t};e.debug=function(t){if(t){if(this.localStorageExists){localStorage.setItem("debug",true);this.log("Enabled Debugging.")}}else{if(this.localStorageExists){this.log("Disabled Debugging.");localStorage.removeItem("debug")}}};e.log=function(t,e){var i=false;if(this.localStorageExists){i=localStorage.getItem("debug")}if((this.settings.debug||i)&&typeof window.console==="object"){if(e==="warn"){console.warn("Warning: "+t)}else{console.log(t)}}};return t}();return t});